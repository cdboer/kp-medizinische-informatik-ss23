WITH sepsis AS (SELECT stay_id FROM mimiciv_derived.sepsis3)
SELECT
	age.age,
	height.height,
	weight.weight,
    lab.platelets_min,
    lab.platelets_max,
    lab.wbc_min,
    lab.wbc_max,
    lab.albumin_min,
    lab.albumin_max,
    lab.globulin_min,
    lab.globulin_max,
    lab.total_protein_min,
    lab.total_protein_max,
    lab.aniongap_min,
    lab.aniongap_max,
    lab.bun_min,
    lab.bun_max,
    lab.creatinine_min,
    lab.creatinine_max,
    lab.abs_basophils_min,
    lab.abs_basophils_max,
    lab.abs_eosinophils_min,
    lab.abs_eosinophils_max,
    lab.abs_lymphocytes_min,
    lab.abs_lymphocytes_max,
    lab.abs_monocytes_min,
    lab.abs_monocytes_max,
    lab.abs_neutrophils_min,
    lab.abs_neutrophils_max,
    lab.atyps_min,
    lab.atyps_max,
    lab.bands_min,
    lab.bands_max,
    lab.imm_granulocytes_min,
    lab.imm_granulocytes_max,
    lab.metas_min,
    lab.metas_max,
    lab.nrbc_min,
    lab.nrbc_max,
    lab.d_dimer_min,
    lab.d_dimer_max,
    lab.fibrinogen_min,
    lab.fibrinogen_max,
    lab.thrombin_min,
    lab.thrombin_max,
    lab.inr_min,
    lab.inr_max,
    lab.pt_min,
    lab.pt_max,
    lab.ptt_min,
    lab.ptt_max,
    lab.alt_min,
    lab.alt_max,
    lab.alp_min,
    lab.alp_max,
    lab.ast_min,
    lab.ast_max,
    lab.amylase_min,
    lab.amylase_max,
    lab.bilirubin_total_min,
    lab.bilirubin_total_max,
    lab.bilirubin_direct_min,
    lab.bilirubin_direct_max,
    lab.bilirubin_indirect_min,
    lab.bilirubin_indirect_max,
    lab.ck_cpk_min,
    lab.ck_cpk_max,
    lab.ck_mb_min,
    lab.ck_mb_max,
    lab.ggt_min,
    lab.ggt_max,
    lab.ld_ldh_min,
    lab.ld_ldh_max,
	CASE WHEN icu.stay_id in (SELECT * FROM sepsis) THEN 1 ELSE 0 END AS sepsis
FROM mimiciv_icu.icustays icu
LEFT JOIN mimiciv_derived.age age
ON icu.subject_id = age.subject_id
LEFT JOIN mimiciv_derived.height height
ON icu.stay_id = height.stay_id
LEFT JOIN mimiciv_derived.first_day_weight weight
ON icu.stay_id = weight.stay_id
LEFT JOIN mimiciv_derived.first_day_lab lab
ON icu.stay_id = lab.stay_id